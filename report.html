<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Report — APERTURE Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,700;0,9..144,800;1,9..144,400&family=Martian+Mono:wght@400;500&family=Source+Serif+4:ital,wght@0,400;1,300&display=swap" rel="stylesheet">
<style>
:root{--void:#050403;--ink:#0d0b08;--ink-mid:#1a1612;--parchment:#f2ede3;--parchment-dim:rgba(242,237,227,0.62);--gold:#b8943f;--gold-bright:#d4aa50;--gold-line:rgba(184,148,63,0.22);--signal:#2a6e3f;--signal-dim:rgba(42,110,63,0.15);--risk-high:#c0392b;--risk-med:#d4aa50;--risk-low:#2a6e3f;}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--void);color:var(--parchment);font-family:'Source Serif 4',Georgia,serif;min-height:100vh;}
.nav{background:rgba(5,4,3,0.93);backdrop-filter:blur(20px);border-bottom:1px solid var(--gold-line);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;}
.nav-logo{font-family:'Fraunces',serif;font-size:1.25rem;font-weight:800;color:var(--gold);text-decoration:none;}
.nav-links{display:flex;gap:1.5rem;align-items:center;}
.nav-link{font-family:'Martian Mono',monospace;font-size:0.55rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--parchment-dim);text-decoration:none;transition:color 0.2s;}
.nav-link:hover{color:var(--gold);}

.page{max-width:900px;margin:0 auto;padding:3rem 2rem 4rem;}

/* Loading & Error */
.loading-state{text-align:center;padding:6rem 2rem;}
.loading-spinner{width:40px;height:40px;border:2px solid var(--gold-line);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 1.5rem;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading-text{font-family:'Martian Mono',monospace;font-size:0.65rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--parchment-dim);}
.error-state{text-align:center;padding:6rem 2rem;display:none;}
.error-state h2{font-family:'Fraunces',serif;font-size:1.5rem;margin-bottom:0.75rem;}
.error-state p{color:var(--parchment-dim);font-style:italic;margin-bottom:2rem;}

/* Report meta */
.report-container{display:none;}
.report-meta{border:1px solid var(--gold-line);margin-bottom:2rem;overflow:hidden;}
.report-meta-header{background:var(--ink-mid);border-bottom:1px solid var(--gold-line);padding:0.8rem 1.5rem;font-family:'Martian Mono',monospace;font-size:0.5rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--gold);}
.report-meta-body{padding:1.5rem;display:flex;gap:2rem;flex-wrap:wrap;}
.meta-item{flex:1;min-width:140px;}
.meta-label{font-family:'Martian Mono',monospace;font-size:0.45rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--parchment-dim);margin-bottom:0.25rem;}
.meta-value{font-size:1rem;}

/* Toolbar */
.report-toolbar{display:flex;gap:0.6rem;margin-bottom:2rem;flex-wrap:wrap;align-items:center;}
.toolbar-btn{font-family:'Martian Mono',monospace;font-size:0.52rem;letter-spacing:0.12em;text-transform:uppercase;background:transparent;border:1px solid var(--gold-line);color:var(--parchment-dim);padding:0.6rem 1rem;cursor:pointer;transition:all 0.25s;text-decoration:none;display:inline-flex;align-items:center;gap:0.4rem;}
.toolbar-btn:hover{border-color:var(--gold);color:var(--gold);}
.toolbar-btn.copied{border-color:var(--signal);color:#5ab87a;}
.toolbar-spacer{flex:1;}

/* ========== REPORT BODY STYLES ========== */
.report-body{background:var(--ink);border:1px solid var(--gold-line);padding:2.5rem 3rem;line-height:1.8;font-size:1rem;position:relative;}
.report-body::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 70% 50% at 100% 0%,rgba(184,148,63,0.03),transparent);pointer-events:none;}

/* Headings */
.report-body h1{font-family:'Fraunces',serif;font-size:1.85rem;font-weight:800;margin:2rem 0 0.75rem;color:var(--parchment);line-height:1.2;}
.report-body h1:first-child{margin-top:0;}
.report-body h2{font-family:'Fraunces',serif;font-size:1.4rem;font-weight:700;margin:2.5rem 0 0.75rem;color:var(--gold-bright);border-bottom:1px solid var(--gold-line);padding-bottom:0.5rem;}
.report-body h2:first-child{margin-top:0;}
.report-body h3{font-family:'Fraunces',serif;font-size:1.15rem;font-weight:700;margin:2rem 0 0.5rem;color:var(--parchment);}
.report-body h4{font-family:'Martian Mono',monospace;font-size:0.72rem;letter-spacing:0.1em;text-transform:uppercase;margin:1.5rem 0 0.4rem;color:var(--gold);}

/* Text */
.report-body p{margin-bottom:1rem;color:var(--parchment-dim);line-height:1.85;}
.report-body strong{color:var(--parchment);font-weight:600;}
.report-body em{font-style:italic;}
.report-body del{text-decoration:line-through;opacity:0.6;}
.report-body hr{border:none;border-top:1px solid var(--gold-line);margin:2.5rem 0;}

/* Lists */
.report-body ul,.report-body ol{margin:0.5rem 0 1.25rem 1.5rem;color:var(--parchment-dim);}
.report-body li{margin-bottom:0.5rem;line-height:1.7;}
.report-body li strong{color:var(--parchment);}

/* Blockquotes — used for "Bottom Line" callouts */
.report-body blockquote{border-left:3px solid var(--gold);padding:1rem 1.5rem;margin:1.5rem 0;background:rgba(184,148,63,0.06);border-radius:0 4px 4px 0;font-style:italic;color:var(--parchment);line-height:1.7;}
.report-body blockquote strong{color:var(--gold-bright);}

/* Tables */
.report-body .table-wrap{overflow-x:auto;margin:1.5rem 0;}
.report-body table{width:100%;border-collapse:collapse;font-size:0.85rem;line-height:1.5;}
.report-body thead{position:sticky;top:0;}
.report-body th{font-family:'Martian Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;text-transform:uppercase;background:var(--ink-mid);color:var(--gold);padding:0.7rem 0.8rem;text-align:left;border:1px solid var(--gold-line);white-space:nowrap;}
.report-body td{padding:0.6rem 0.8rem;border:1px solid rgba(184,148,63,0.12);color:var(--parchment-dim);vertical-align:top;}
.report-body tbody tr:hover{background:rgba(184,148,63,0.03);}

/* Inline code */
.report-body code{font-family:'Martian Mono',monospace;font-size:0.78em;background:var(--ink-mid);padding:0.15rem 0.45rem;border-radius:3px;color:var(--gold-bright);border:1px solid rgba(184,148,63,0.1);}

/* Tags / Badges */
.report-body .tag{display:inline-block;font-family:'Martian Mono',monospace;font-size:0.5rem;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;padding:0.2rem 0.6rem;border-radius:3px;vertical-align:middle;margin-left:0.3rem;}
.report-body .tag-macro{background:rgba(184,148,63,0.15);color:var(--gold-bright);border:1px solid rgba(184,148,63,0.3);}
.report-body .tag-micro{background:rgba(42,110,63,0.15);color:#5ab87a;border:1px solid rgba(42,110,63,0.3);}
.report-body .tag-high{background:rgba(192,57,43,0.15);color:#e74c3c;border:1px solid rgba(192,57,43,0.3);}
.report-body .tag-med{background:rgba(212,170,80,0.15);color:var(--gold-bright);border:1px solid rgba(212,170,80,0.3);}
.report-body .tag-low{background:rgba(42,110,63,0.15);color:#5ab87a;border:1px solid rgba(42,110,63,0.3);}

/* CTA */
.report-cta{border:1px solid var(--gold-line);padding:2rem;margin-top:2rem;display:flex;align-items:center;justify-content:space-between;gap:1.5rem;flex-wrap:wrap;}
.cta-text h3{font-family:'Fraunces',serif;font-size:1.05rem;font-weight:700;margin-bottom:0.25rem;}
.cta-text p{font-size:0.87rem;color:var(--parchment-dim);font-style:italic;}
.btn-gold{font-family:'Martian Mono',monospace;font-size:0.6rem;letter-spacing:0.18em;text-transform:uppercase;background:var(--gold);color:var(--void);border:none;padding:0.85rem 1.75rem;cursor:pointer;text-decoration:none;display:inline-block;transition:background 0.3s;white-space:nowrap;}
.btn-gold:hover{background:var(--gold-bright);}

footer{border-top:1px solid var(--gold-line);margin-top:4rem;padding:2rem;text-align:center;font-family:'Martian Mono',monospace;font-size:0.5rem;letter-spacing:0.12em;text-transform:uppercase;color:rgba(242,237,227,0.2);line-height:2;}
footer a{color:rgba(184,148,63,0.5);text-decoration:none;}

@media(max-width:640px){
  .report-body{padding:1.5rem 1.25rem;}
  .report-body h2{font-size:1.2rem;}
  .report-body table{font-size:0.75rem;}
  .report-body th,.report-body td{padding:0.4rem 0.5rem;}
}

@media print{
  body{background:#fff;color:#111;}
  .nav,.report-toolbar,.report-cta,footer{display:none!important;}
  .page{padding:0;max-width:100%;}
  .report-body{border:none;padding:0;background:transparent;}
  .report-body::before{display:none;}
  .report-body h2{color:#333;border-bottom-color:#ccc;}
  .report-body h3{color:#222;}
  .report-body p,.report-body li,.report-body td{color:#333;}
  .report-body th{background:#f0f0f0;color:#333;}
  .report-body blockquote{background:#f8f8f8;border-left-color:#999;}
  .report-body .tag{border-color:#999;color:#333;background:#eee;}
  .report-meta{border-color:#ccc;}
  .report-meta-header{background:#f5f5f5;color:#333;border-bottom-color:#ccc;}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">APERTURE</a>
  <div class="nav-links">
    <a href="/markets/" class="nav-link">Browse Markets</a>
    <a href="/" class="nav-link">Order Report</a>
  </div>
</nav>

<div class="page">
  <div class="loading-state" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Retrieving your report...</div>
  </div>

  <div class="error-state" id="error">
    <h2>Report Not Found</h2>
    <p id="error-msg">This report could not be found. It may have been removed or the link may be incorrect.</p>
    <a href="/" class="btn-gold">Order a Report</a>
  </div>

  <div class="report-container" id="report-container">
    <div class="report-meta">
      <div class="report-meta-header">Intelligence Report</div>
      <div class="report-meta-body">
        <div class="meta-item">
          <div class="meta-label">Market</div>
          <div class="meta-value" id="r-market">—</div>
        </div>
        <div class="meta-item">
          <div class="meta-label">Tier</div>
          <div class="meta-value" id="r-tier">—</div>
        </div>
        <div class="meta-item">
          <div class="meta-label">Generated</div>
          <div class="meta-value" id="r-date">—</div>
        </div>
      </div>
    </div>

    <div class="report-toolbar">
      <button class="toolbar-btn" onclick="copyLink()">Copy Link</button>
      <button class="toolbar-btn" onclick="window.print()">Print / PDF</button>
      <div class="toolbar-spacer"></div>
      <a href="/" class="toolbar-btn">Order Another Report</a>
    </div>

    <div class="report-body" id="r-body"></div>

    <div class="report-cta">
      <div class="cta-text">
        <h3>Need deeper analysis?</h3>
        <p>Upgrade to a higher tier for expanded sections and strategic recommendations.</p>
      </div>
      <a href="/#pricing" class="btn-gold">View Tiers</a>
    </div>
  </div>
</div>

<footer>
  <a href="/">APERTURE Intelligence</a> · AI Market Research in Minutes ·
  <a href="/markets/">Browse all markets</a> ·
  <a href="/quiz">Free snapshot quiz</a>
</footer>

<script src="/js/markdown-renderer.js"></script>
<script>
var params = new URLSearchParams(window.location.search);
var reportId = params.get('id');

if (!reportId) {
  showError('No report ID provided. Please use the link from your email or success page.');
} else {
  loadReport(reportId);
}

async function loadReport(id) {
  try {
    var res = await fetch('/api/view-report?id=' + encodeURIComponent(id));
    if (!res.ok) {
      var errData = await res.json().catch(function() { return {}; });
      throw new Error(errData.error || 'Report not found');
    }
    var data = await res.json();
    renderReport(data);
  } catch (err) {
    showError(err.message);
  }
}

function renderReport(data) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('report-container').style.display = 'block';
  document.getElementById('r-market').textContent = data.market || 'Market Intelligence';
  document.getElementById('r-tier').textContent = (data.tier || 'standard').charAt(0).toUpperCase() + (data.tier || '').slice(1);
  document.getElementById('r-date').textContent = data.created ? new Date(data.created).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : '—';
  document.title = (data.market || 'Report') + ' — APERTURE Intelligence';
  document.getElementById('r-body').innerHTML = markdownToHtml(data.report || '');
}

function showError(msg) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('error').style.display = 'block';
  if (msg) document.getElementById('error-msg').textContent = msg;
}

function copyLink() {
  navigator.clipboard.writeText(window.location.href).then(function() {
    var btn = document.querySelector('.toolbar-btn');
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    setTimeout(function() { btn.textContent = 'Copy Link'; btn.classList.remove('copied'); }, 2500);
  });
}
</script>
</body>
</html>
